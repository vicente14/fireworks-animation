<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>烟花动画</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#EC4899',
                        accent: '#10B981',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .firework {
                position: absolute;
                bottom: 0;
                width: 6px;
                height: 6px;
                border-radius: 50%;
                opacity: 0;
                transform: scale(0);
                transition: transform 0.2s ease-out, opacity 0.2s ease-out;
            }
            .particle {
                position: absolute;
                opacity: 0;
                transform-origin: center;
            }
            .particle-dot {
                width: 4px;
                height: 4px;
                border-radius: 50%;
            }
            .particle-line {
                width: 2px;
                height: 18px;
                transform: rotate(0deg);
                background: linear-gradient(to top, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.8));
            }
            .birthday-text {
                position: fixed;
                top: 10%;
                left: 0;
                right: 0;
                text-align: center;
                font-size: clamp(1.5rem, 6vw, 4rem);
                font-weight: bold;
                z-index: 10;
                opacity: 0;
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            .line {
                display: flex;
                justify-content: center;
                margin: 0.3rem 0;
            }
            .letter {
                display: inline-block;
                opacity: 0;
                transform: translateY(20px);
                transition: opacity 0.5s ease-out, transform 0.5s ease-out;
            }
        }
    </style>
</head>

<body class="bg-gradient-to-b from-gray-900 to-black min-h-screen overflow-hidden">
    <div id="fireworksContainer" class="fixed inset-0 z-0"></div>
    <div class="birthday-text" id="birthdayText"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('fireworksContainer');
            let animationInterval;
            let isCreatingFireworks = false;

            // 烟花颜色数组
            const colors = [
                '#FF3366', '#FF9933', '#FFFF33', '#33FF33', '#3399FF',
                '#9933FF', '#FF33FF', '#FF6666', '#FFCC66', '#CCFF66',
                '#66FF66', '#66FFCC', '#66CCFF', '#6666FF', '#CC66FF'
            ];

            // 随机数生成函数
            function random(min, max) {
                return Math.random() * (max - min) + min;
            }

            // Fisher-Yates 洗牌算法
            function shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }

            // 创建烟花升空效果
            function createFirework(x, y, targetX, targetY, color) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.backgroundColor = color;
                firework.style.left = `${x}px`;
                firework.style.bottom = '0px';
                container.appendChild(firework);

                // 计算烟花上升距离和持续时间
                const distance = Math.sqrt(Math.pow(targetX - x, 2) + Math.pow(targetY, 2));
                const duration = random(1.5, 2.5) * (distance / 500);

                // 设置烟花上升动画
                setTimeout(() => {
                    firework.style.opacity = '1';
                    firework.style.transform = 'scale(1)';

                    const animation = firework.animate([
                        { bottom: '0px', left: `${x}px` },
                        { bottom: `${targetY}px`, left: `${targetX}px` }
                    ], {
                        duration: duration * 1000,
                        easing: 'cubic-bezier(0.25, 0.1, 0.25, 1)'
                    });

                    animation.onfinish = () => {
                        // 随机选择爆炸类型
                        const explosionTypes = ['default', 'ring', 'pulse', 'star'];
                        const explosionType = explosionTypes[Math.floor(Math.random() * explosionTypes.length)];
                        explodeFirework(targetX, targetY, color, explosionType);
                        firework.remove();
                    };
                }, 50);
            }

            // 创建烟花爆炸效果
            function explodeFirework(x, y, color, explosionType = 'default') {
                switch (explosionType) {
                    case 'ring':
                        // 环形爆炸
                        const ringParticleCount = 60;
                        const ringRadius = 100;
                        for (let i = 0; i < ringParticleCount; i++) {
                            const angle = (i / ringParticleCount) * (Math.PI * 2);
                            const particle = createParticle(x, y, color);
                            const vx = Math.cos(angle) * ringRadius;
                            const vy = Math.sin(angle) * ringRadius;
                            animateParticle(particle, x, y, vx, vy);
                        }
                        break;
                    case 'pulse':
                        // 脉冲爆炸
                        const pulseCount = 3;
                        const pulseDelay = 200;
                        const pulseParticleCount = 40;
                        for (let j = 0; j < pulseCount; j++) {
                            setTimeout(() => {
                                for (let i = 0; i < pulseParticleCount; i++) {
                                    const particle = createParticle(x, y, color);
                                    const angle = random(0, Math.PI * 2);
                                    const distance = random(30, 150);
                                    const vx = Math.cos(angle) * distance;
                                    const vy = Math.sin(angle) * distance;
                                    animateParticle(particle, x, y, vx, vy);
                                }
                            }, j * pulseDelay);
                        }
                        break;
                    case 'star':
                        // 星形爆炸
                        const starPoints = 5;
                        const starRadius = 120;
                        const starInnerRadius = 50;
                        for (let i = 0; i < starPoints * 2; i++) {
                            const radius = i % 2 === 0 ? starRadius : starInnerRadius;
                            const angle = (i / (starPoints * 2)) * (Math.PI * 2);
                            const particle = createParticle(x, y, color);
                            const vx = Math.cos(angle) * radius;
                            const vy = Math.sin(angle) * radius;
                            animateParticle(particle, x, y, vx, vy);
                        }
                        break;
                    default:
                        // 原有的爆炸效果
                        const layers = [
                            { count: 30, size: 1.2, speed: 1.3, lineRatio: 0.5, delay: 0 },
                            { count: 50, size: 1, speed: 1, lineRatio: 0.4, delay: 100 },
                            { count: 40, size: 0.8, speed: 0.7, lineRatio: 0.3, delay: 200 }
                        ];

                        layers.forEach(layer => {
                            setTimeout(() => {
                                for (let i = 0; i < layer.count; i++) {
                                    const isLine = i < layer.count * layer.lineRatio;
                                    const particle = document.createElement('div');

                                    if (isLine) {
                                        particle.className = 'particle particle-line';
                                    } else {
                                        particle.className = 'particle particle-dot';
                                    }

                                    const useMainColor = Math.random() > 0.4;
                                    const particleColor = useMainColor ? color : colors[Math.floor(Math.random() * colors.length)];

                                    if (!isLine) {
                                        particle.style.backgroundColor = particleColor;
                                    } else {
                                        const opacityStart = Math.random() > 0.5 ? '40' : '60';
                                        const opacityEnd = Math.random() > 0.5 ? 'A0' : 'FF';
                                        particle.style.background = `linear-gradient(to top, ${particleColor}${opacityStart}, ${particleColor}${opacityEnd})`;
                                    }

                                    particle.style.left = `${x}px`;
                                    particle.style.bottom = `${y}px`;

                                    if (isLine) {
                                        const angle = random(0, Math.PI * 2);
                                        particle.style.transform = `rotate(${angle}rad)`;
                                        const lineLength = random(14, 22);
                                        particle.style.height = `${lineLength}px`;
                                    }

                                    container.appendChild(particle);

                                    const angle = random(0, Math.PI * 2);
                                    const distance = random(30, 150) * layer.speed;
                                    const vx = Math.cos(angle) * distance;
                                    const vy = Math.sin(angle) * distance;
                                    const gravityEffect = random(0, 25);
                                    const baseDuration = layer === layers[0] ? 1.2 : layer === layers[1] ? 1.6 : 2.0;
                                    const duration = random(baseDuration, baseDuration + 0.6) * 1000;

                                    const animation = particle.animate([
                                        {
                                            left: `${x}px`,
                                            bottom: `${y}px`,
                                            opacity: 1,
                                            transform: isLine ? `rotate(${angle}rad) scale(${layer.size})` : `scale(${layer.size})`
                                        },
                                        {
                                            left: `${x + vx}px`,
                                            bottom: `${y + vy - gravityEffect}px`,
                                            opacity: 0.8,
                                            transform: isLine ? `rotate(${angle + random(-0.3, 0.3)}rad) scale(${layer.size * 0.8})` : `scale(${layer.size * 0.8})`
                                        },
                                        {
                                            left: `${x + vx * 1.1}px`,
                                            bottom: `${y + vy * 1.1 - gravityEffect * 2}px`,
                                            opacity: 0,
                                            transform: isLine ? `rotate(${angle + random(-0.5, 0.5)}rad) scale(0)` : `scale(0)`
                                        }
                                    ], {
                                        duration: duration,
                                        easing: 'cubic-bezier(0.2, 0.8, 0.2, 1)'
                                    });

                                    animation.onfinish = () => {
                                        particle.remove();
                                    };
                                }
                            }, layer.delay);
                        });
                        break;
                }

                // 添加爆炸音效
                playFireworkSound();
            }

            // 创建粒子
            function createParticle(x, y, color) {
                const particle = document.createElement('div');
                particle.className = 'particle particle-dot';
                particle.style.backgroundColor = color;
                particle.style.left = `${x}px`;
                particle.style.bottom = `${y}px`;
                container.appendChild(particle);
                return particle;
            }

            // 动画粒子
            function animateParticle(particle, x, y, vx, vy) {
                const gravityEffect = random(0, 25);
                const duration = random(1.2, 2.0) * 1000;
                const animation = particle.animate([
                    {
                        left: `${x}px`,
                        bottom: `${y}px`,
                        opacity: 1,
                        transform: `scale(1)`
                    },
                    {
                        left: `${x + vx}px`,
                        bottom: `${y + vy - gravityEffect}px`,
                        opacity: 0.8,
                        transform: `scale(0.8)`
                    },
                    {
                        left: `${x + vx * 1.1}px`,
                        bottom: `${y + vy * 1.1 - gravityEffect * 2}px`,
                        opacity: 0,
                        transform: `scale(0)`
                    }
                ], {
                    duration: duration,
                    easing: 'cubic-bezier(0.2, 0.8, 0.2, 1)'
                });

                animation.onfinish = () => {
                    particle.remove();
                };
            }

            // 播放烟花音效
            function playFireworkSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.5);

                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(1, audioContext.currentTime + 0.05);
                    gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.5);

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (error) {
                    console.warn('无法播放音效:', error);
                }
            }

            // 创建1-3个随机烟花
            function createRandomFireworks() {
                if (isCreatingFireworks) return;

                isCreatingFireworks = true;

                const fireworkCount = Math.floor(Math.random() * 3) + 1;

                for (let i = 0; i < fireworkCount; i++) {
                    const x = random(50, window.innerWidth - 50);
                    const targetY = random(window.innerHeight * 0.3, window.innerHeight * 0.7);
                    const color = colors[Math.floor(Math.random() * colors.length)];

                    const startX = x + random(-50, 50);

                    setTimeout(() => {
                        createFirework(startX, 0, x, targetY, color);
                    }, i * 800);
                }

                setTimeout(() => {
                    isCreatingFireworks = false;
                }, 1500);
            }

            // 点击事件处理
            container.addEventListener('click', (e) => {
                const x = e.clientX;
                const targetY = random(window.innerHeight * 0.3, window.innerHeight * 0.7);
                const color = colors[Math.floor(Math.random() * colors.length)];

                const startX = x + random(-50, 50);
                createFirework(startX, 0, x, targetY, color);
            });

            // 页面加载后立即开始自动播放烟花
            animationInterval = setInterval(createRandomFireworks, random(1500, 3000));

            // 窗口大小变化时调整
            window.addEventListener('resize', () => {
                if (animationInterval) clearInterval(animationInterval);

                setTimeout(() => {
                    animationInterval = setInterval(createRandomFireworks, random(1500, 3000));
                }, 500);
            });

            // 随机彩色字母动画
            function animateText() {
                const textElement = document.getElementById('birthdayText');

                const lines = ["HAPPY", "BIRTHDAY", "MR.X"];
                let totalDelay = 0;

                textElement.innerHTML = '';

                lines.forEach((lineText, lineIndex) => {
                    const lineElement = document.createElement('div');
                    lineElement.className = 'line';
                    textElement.appendChild(lineElement);

                    const shuffledChars = shuffleArray(
                        lineText.split('').map((char, index) => ({ char, index }))
                    );

                    const placeholders = [];
                    for (let i = 0; i < lineText.length; i++) {
                        const placeholder = document.createElement('span');
                        placeholder.className = 'letter';
                        placeholder.textContent = ' ';
                        lineElement.appendChild(placeholder);
                        placeholders.push(placeholder);
                    }

                    let lineDelay = 0;

                    shuffledChars.forEach((item, i) => {
                        const letter = document.createElement('span');
                        letter.className = 'letter';
                        letter.textContent = item.char;

                        const randomColor = colors[Math.floor(Math.random() * colors.length)];
                        letter.style.color = randomColor;

                        letter.style.textShadow = `0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px ${randomColor}40`;

                        const randomDelay = random(0.5, 1.5);
                        lineDelay += randomDelay;

                        const totalLetterDelay = totalDelay + lineDelay + (lineIndex * 1.5);

                        if (placeholders[item.index]) {
                            placeholders[item.index].replaceWith(letter);
                        } else {
                            lineElement.appendChild(letter);
                        }

                        letter.style.animation = `fadeIn 0.5s ease-out ${totalLetterDelay}s forwards`;
                    });

                    totalDelay += lineDelay;
                });

                textElement.style.opacity = '1';
            }

            // 添加字母动画样式
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from {
                        opacity: 0;
                        transform: translateY(20px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
            `;
            document.head.appendChild(style);

            // 3秒后开始字母动画
            setTimeout(animateText, 3000);
        });
    </script>
</body>

</html>
